# -*- coding: utf-8 -*-
"""EV_Vehicle/Charging_Demand_Prediction_Project.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zDCxUkmpuSr72-wmurehQVAw39Op6iGz
"""

import joblib
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.preprocessing import LabelEncoder
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split, RandomizedSearchCV
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
from google.colab import files

uploaded = files.upload()
df = pd.read_csv("Electric_Vehicle_Population_By_County.csv")

df.shape
df.info()
df.isnull().sum()

Q1 = df['Percent Electric Vehicles'].quantile(0.25)
Q3 = df['Percent Electric Vehicles'].quantile(0.75)
IQR = Q3 - Q1

lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

print('lower_bound:', lower_bound)
print('upper_bound:', upper_bound)

outliers = df[
    (df['Percent Electric Vehicles'] < lower_bound) |
    (df['Percent Electric Vehicles'] > upper_bound)
]
print("Number of outliers in 'Percent Electric Vehicles':", outliers.shape[0])

df['Date'] = pd.to_datetime(df['Date'], errors='coerce')
df = df[df['Date'].notnull()]
df = df[df['Electric Vehicle (EV) Total'].notnull()]
df['County'] = df['County'].fillna('Unknown')
df['State'] = df['State'].fillna('Unknown')

print("Missing after fill:")
print(df[['County', 'State']].isnull().sum())

df['Percent Electric Vehicles'] = np.where(
    df['Percent Electric Vehicles'] > upper_bound, upper_bound,
    np.where(df['Percent Electric Vehicles'] < lower_bound, lower_bound, df['Percent Electric Vehicles'])
)

outliers = df[
    (df['Percent Electric Vehicles'] < lower_bound) |
    (df['Percent Electric Vehicles'] > upper_bound)
]
print("Number of outliers in 'Percent Electric Vehicles':", outliers.shape[0])

